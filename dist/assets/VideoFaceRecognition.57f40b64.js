import{f as e}from"./index.5070ea57.js";import{O as t,P as a,o as s,i,N as n,a0 as l,a1 as o,a2 as d,k as c}from"./vendor.51cee63a.js";import{_ as u}from"./test.b5925835.js";import{n as h,l as r,m,s as v,M as p,T as f,S as E,d as g,q as b}from"./FaceMatcher.9cf7eaf3.js";import{m as F,r as w}from"./resizeResults.7ec8b892.js";import{d as y}from"./drawDetections.4fc2c34e.js";import{d as x}from"./drawFaceExpressions.5723c421.js";import"./fetchImage.05f71b13.js";import"./detectFaces.dcb5ab79.js";const R={name:"VideoAgeAndGenderRecognition",data:()=>({nets:"tinyFaceDetector",options:null,withBoxes:!0,detectFace:"detectSingleFace",detection:"landmark",videoEl:null,canvasEl:null,timeout:0}),watch:{nets(e){this.nets=e,this.fnInit()},detection(e){this.detection=e,this.videoEl.paused||(this.videoEl.pause(),setTimeout((()=>{this.videoEl.play(),setTimeout((()=>this.fnRun()),300)}),300))}},mounted(){this.$nextTick((()=>{this.fnInit()}))},methods:{async fnInit(){switch(await h[this.nets].loadFromUri("/models"),await r("/models"),await m("/models"),await v("/models"),this.nets){case"ssdMobilenetv1":this.options=new E({minConfidence:.5});break;case"tinyFaceDetector":this.options=new f({inputSize:512,scoreThreshold:.5});break;case"mtcnn":this.options=new p({minFaceSize:20,scaleFactor:.709})}this.videoEl=document.getElementById("myVideo"),this.canvasEl=document.getElementById("myCanvas")},async fnRunFaceLandmark(){if(console.log("RunFaceLandmark"),this.videoEl.paused)return clearTimeout(this.timeout);const t=await e[this.detectFace](this.videoEl,this.options).withFaceLandmarks();if(t){const e=F(this.canvasEl,this.videoEl,!0),a=w(t,e);this.withBoxes?y(this.canvasEl,a):g(this.canvasEl,a)}else this.canvasEl.getContext("2d").clearRect(0,0,this.canvasEl.width,this.canvasEl.height);this.timeout=setTimeout((()=>this.fnRunFaceLandmark()),20)},async fnRunFaceExpression(){if(console.log("RunFaceExpression"),this.videoEl.paused)return clearTimeout(this.timeout);const t=await e[this.detectFace](this.videoEl,this.options).withFaceLandmarks().withFaceExpressions();if(t){const e=F(this.canvasEl,this.videoEl,!0),a=w(t,e);x(this.canvasEl,a,.5),this.withBoxes?y(this.canvasEl,a):g(this.canvasEl,a)}else this.canvasEl.getContext("2d").clearRect(0,0,this.canvasEl.width,this.canvasEl.height);this.timeout=setTimeout((()=>this.fnRunFaceExpression()),20)},async fnRunFaceAgeAndGender(){if(console.log("RunFaceAgeAndGender"),this.videoEl.paused)return clearTimeout(this.timeout);const t=await e[this.detectFace](this.videoEl,this.options).withFaceLandmarks().withAgeAndGender();if(t){const e=F(this.canvasEl,this.videoEl,!0),a=w(t,e);if(this.withBoxes?y(this.canvasEl,a):g(this.canvasEl,a),Array.isArray(a))a.forEach((e=>{const{age:t,gender:a,genderProbability:s}=e;new b([`${Math.round(t,0)} years`,`${a} (${Math.round(s)})`],e.detection.box.bottomLeft).draw(this.canvasEl)}));else{const{age:e,gender:t,genderProbability:s}=a;new b([`${Math.round(e,0)} years`,`${t} (${Math.round(s)})`],a.detection.box.bottomLeft).draw(this.canvasEl)}}else this.canvasEl.getContext("2d").clearRect(0,0,this.canvasEl.width,this.canvasEl.height);this.timeout=setTimeout((()=>this.fnRunFaceAgeAndGender()),20)},fnRun(){"landmark"!==this.detection?"expression"!==this.detection?"age_gender"!==this.detection||this.fnRunFaceAgeAndGender():this.fnRunFaceExpression():this.fnRunFaceLandmark()},fnPaused(){this.videoEl.paused?(this.videoEl.play(),setTimeout((()=>this.fnRun()),300)):this.videoEl.pause()},fnChange(e){e.target.files.length&&(this.videoEl.pause(),setTimeout((()=>{this.canvasEl.getContext("2d").clearRect(0,0,this.canvasEl.width,this.canvasEl.height),this.videoEl.src=URL.createObjectURL(e.target.files[0])}),300))}},beforeUnmount(){this.videoEl.pause(),clearTimeout(this.timeout)}};t("data-v-1b6fbbfc");const k={class:"video_face_recognition"},A={class:"option"},T=n("label",null,"视频控制：",-1),U=n("label",null,"更换视频：",-1),V=n("span",{style:{"margin-right":"20px"}},"检测识别类型：",-1),C=c(" 轮廓检测 "),L=c(" 表情检测 "),j=c(" 年龄性别检测 "),M=n("label",null,"边框Or面部轮廓：",-1),B=n("label",null,"检测人脸：",-1),I=c(" 可信单 "),$=c(" 模糊多 "),_=n("label",null,"选择算法模型",-1),G=c(" ssdMobilenetv1 "),P=c(" tinyFaceDetector "),D=c(" mtcnn "),S=n("div",{class:"see"},[n("video",{id:"myVideo",src:u,muted:"",playsinline:""}),n("canvas",{id:"myCanvas"})],-1);a(),R.render=function(e,t,a,c,u,h){return s(),i("div",k,[n("div",A,[n("div",null,[T,n("button",{onClick:t[0]||(t[0]=(...e)=>h.fnPaused&&h.fnPaused(...e))},"暂停Or播放")]),n("div",null,[U,n("input",{type:"file",accept:"video/mp4, video/ogg, video/webm",onChange:t[1]||(t[1]=e=>h.fnChange(e))},null,32)]),n("div",null,[V,n("label",null,[C,l(n("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=e=>u.detection=e),value:"landmark"},null,512),[[o,u.detection]])]),n("label",null,[L,l(n("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=e=>u.detection=e),value:"expression"},null,512),[[o,u.detection]])]),n("label",null,[j,l(n("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=e=>u.detection=e),value:"age_gender"},null,512),[[o,u.detection]])])]),n("div",null,[M,l(n("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>u.withBoxes=e)},null,512),[[d,u.withBoxes]])]),n("div",null,[B,n("label",null,[I,l(n("input",{type:"radio","onUpdate:modelValue":t[6]||(t[6]=e=>u.detectFace=e),value:"detectSingleFace"},null,512),[[o,u.detectFace]])]),n("label",null,[$,l(n("input",{type:"radio","onUpdate:modelValue":t[7]||(t[7]=e=>u.detectFace=e),value:"detectAllFaces"},null,512),[[o,u.detectFace]])])]),n("div",null,[_,n("label",null,[G,l(n("input",{type:"radio","onUpdate:modelValue":t[8]||(t[8]=e=>u.nets=e),value:"ssdMobilenetv1"},null,512),[[o,u.nets]])]),n("label",null,[P,l(n("input",{type:"radio","onUpdate:modelValue":t[9]||(t[9]=e=>u.nets=e),value:"tinyFaceDetector"},null,512),[[o,u.nets]])]),n("label",null,[D,l(n("input",{type:"radio","onUpdate:modelValue":t[10]||(t[10]=e=>u.nets=e),value:"mtcnn"},null,512),[[o,u.nets]])])])]),S])},R.__scopeId="data-v-1b6fbbfc";export{R as default};
