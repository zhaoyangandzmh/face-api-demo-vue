import{r as e,d as a,I as l,b as t,w as s,K as n,a3 as o,i,h as u,g as c,N as r,F as d,z as v,O as m,P as p,o as f,l as h,Z as g,k as b,Q as F,V as j}from"./vendor.51cee63a.js";/* empty css              *//* empty css              */import{f as w}from"./index.5070ea57.js";import{n as x,M as y,T as M,S as T}from"./FaceMatcher.9cf7eaf3.js";import{m as O,r as _}from"./resizeResults.7ec8b892.js";import{d as k}from"./drawDetections.4fc2c34e.js";import"./drawFaceExpressions.5723c421.js";import"./fetchImage.05f71b13.js";import"./detectFaces.dcb5ab79.js";m("data-v-54211ced");const C=r("label",null,"面板操作：",-1),S=b(" 前置后置切换（重新启动摄像头）： "),U=b(" 检测人脸： "),z=b(" 选择算法模型 "),D=r("hr",null,null,-1),R={class:"videoWrap"};p();var I=a({setup(a){const m=l("loading"),{init:p,algorithmType:b,modelOption:I,algorithmOptions:L}=(a=>{const l=e("ssdMobilenetv1"),t=e({});return{init:async()=>{switch(a.startLoading("模块资源加载中"),await x[l.value].loadFromUri("/models"),a.stopLoading(),l.value){case"ssdMobilenetv1":t.value=new T({minConfidence:.5});break;case"tinyFaceDetector":t.value=new M({inputSize:512,scoreThreshold:.5});break;case"mtcnn":t.value=new y({minFaceSize:20,scaleFactor:.709})}},algorithmType:l,modelOption:t,algorithmOptions:["ssdMobilenetv1","tinyFaceDetector","mtcnn"]}})(m),A=[{label:"前置",value:"user"},{label:"后置",value:"environment"}],E=[{label:"可信单",value:"detectSingleFace"},{label:"模糊多",value:"detectAllFaces"}],q=t({audio:!1,video:{width:{min:320,ideal:960,max:1920},height:{min:240,ideal:540,max:1080},frameRate:{min:15,ideal:30,max:60},facingMode:"user"}}),K=e("detectSingleFace"),N=e();let P=null;const Q=e(),V=e(),W=e=>{P=e,Q.value.srcObject=e,Q.value.play()},Z=e=>{alert("视频媒体流获取错误"+e)},B=()=>{P||(clearTimeout(N.value),N.value=setTimeout((()=>{clearTimeout(N.value),navigator.mediaDevices.getUserMedia(q).then(W).catch(Z)}),500))},G=()=>{V.value.getContext("2d").clearRect(0,0,V.value.width,V.value.height),Q.value.pause(),clearTimeout(N.value),P&&(Q.value.srcObject=null,null==P||P.getTracks().forEach((e=>e.stop())),P=null)},H=async()=>{const e=await w[K.value](Q.value,I.value);if(e&&!Q.value.paused){const a=O(V.value,Q.value,!0),l=_(e,a);k(V.value,l)}else V.value.getContext("2d").clearRect(0,0,V.value.width,V.value.height);requestAnimationFrame(H)};return s(b,(()=>{p()})),n(p),o(G),(e,a)=>{const l=F,t=j,s=v;return f(),i(d,null,[u(s,null,{default:c((()=>[u(l,null,{default:c((()=>[r("div",null,[C,r("button",{onClick:B},"启动摄像头视频媒体"),r("button",{onClick:G},"结束摄像头视频媒体")])])),_:1}),u(l,null,{default:c((()=>[S,u(t,{options:A,value:h(q).video.facingMode,"onUpdate:value":a[0]||(a[0]=e=>h(q).video.facingMode=e)},null,8,["value"])])),_:1}),u(l,null,{default:c((()=>[U,u(t,{options:E,value:K.value,"onUpdate:value":a[1]||(a[1]=e=>K.value=e)},null,8,["value"])])),_:1}),u(l,null,{default:c((()=>[z,u(t,{options:h(L),value:h(b),"onUpdate:value":a[2]||(a[2]=e=>g(b)?b.value=e:null)},null,8,["options","value"])])),_:1})])),_:1}),D,r("div",R,[r("video",{ref:Q,poster:"https://dummyimage.com/960x540",muted:"",loop:"",playsinline:"",onLoadedmetadata:H},null,544),r("canvas",{ref:V},null,512)])],64)}}});I.__scopeId="data-v-54211ced";export{I as default};
